<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>喻见小程序</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- 主应用容器 -->
    <div class="app-container">
      <!-- 背景圆形容器 -->
      <div class="background-circles">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
      </div>

      <!-- 页面内容容器 -->
      <div class="page-container">
        <!-- 推荐页面 -->
        <div class="page page-recommend active" data-page="recommend">
          <!-- 推荐页面标题栏 -->
          <div class="recommend-tabs">
            <div class="recommend-tab active" data-tab="discover">发现</div>
            <div class="recommend-tab" data-tab="nearby">附近</div>
          </div>
          <!-- 推荐卡片容器 -->
          <div class="recommend-cards-container">
            <!-- 卡片4（最下面，隐藏） -->
            <div class="recommend-card recommend-card-back-3" data-index="3">
              <img
                class="recommend-card-img"
                src="recommend/boy-badminton.jpg"
                alt=""
              />
              <div class="recommend-card-info">
                <div class="recommend-card-name">小宇</div>
                <div class="recommend-card-basic">男 · 24岁</div>
                <div class="recommend-card-desc">
                  羽毛球爱好者，每周都要去打球
                </div>
              </div>
            </div>
            <!-- 卡片3（最后面，最模糊） -->
            <div class="recommend-card recommend-card-back-2" data-index="2">
              <img
                class="recommend-card-img"
                src="recommend/girl-shopping.jpg"
                alt=""
              />
              <div class="recommend-card-info">
                <div class="recommend-card-name">小美</div>
                <div class="recommend-card-basic">女 · 23岁</div>
                <div class="recommend-card-desc">
                  逛街达人，喜欢收集各种漂亮的衣服和包包
                </div>
              </div>
            </div>
            <!-- 卡片2（中间，中等模糊） -->
            <div class="recommend-card recommend-card-back-1" data-index="1">
              <img
                class="recommend-card-img"
                src="recommend/girl-photoing.jpg"
                alt=""
              />
              <div class="recommend-card-info">
                <div class="recommend-card-name">小琳</div>
                <div class="recommend-card-basic">女 · 23岁</div>
                <div class="recommend-card-desc">
                  摄影爱好者，喜欢用镜头记录生活的美好
                </div>
              </div>
            </div>
            <!-- 卡片1（最前面，清晰） -->
            <div class="recommend-card recommend-card-front" data-index="0">
              <img
                class="recommend-card-img"
                src="recommend/girl-skiing.jpg"
                alt=""
              />
              <div class="recommend-card-info">
                <div class="recommend-card-name">小雪</div>
                <div class="recommend-card-basic">女 · 22岁</div>
                <div class="recommend-card-desc">
                  滑雪爱好者，冬天最喜欢去滑雪场
                </div>
              </div>
            </div>
          </div>
          <!-- 操作按钮容器 -->
          <div class="action-buttons-container">
            <button class="action-button action-button-back" data-action="back">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <button
              class="action-button action-button-dislike"
              data-action="dislike"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
            <button class="action-button action-button-like" data-action="like">
              <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                <path
                  d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                ></path>
              </svg>
            </button>
            <button
              class="action-button action-button-favorite"
              data-action="favorite"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                ></polygon>
              </svg>
            </button>
          </div>
          <!-- 卡片详情页 -->
          <div class="card-detail-overlay"></div>
          <div class="card-detail-page">
            <button class="card-detail-back-button">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <div class="card-detail-image-container">
              <img class="card-detail-image" src="" alt="" />
            </div>
            <div class="card-detail-info">
              <div class="card-detail-name"></div>
              <div class="card-detail-basic"></div>
              <div class="card-detail-desc"></div>
            </div>
          </div>
        </div>
        <!-- 社区页面 -->
        <div class="page page-community" data-page="community">
          <div class="community-title">社区</div>
          <div class="community-list"></div>
          <!-- 图片放大查看遮罩 -->
          <div class="community-image-overlay"></div>
          <div class="community-image-viewer">
            <button class="community-image-close">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
            <img class="community-viewer-image" src="" alt="" />
          </div>
          <!-- 社区发布详情页 -->
          <div class="community-post-detail-overlay"></div>
          <div class="community-post-detail-page">
            <button class="community-post-detail-close">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <div class="community-post-detail-content"></div>
          </div>
        </div>

        <!-- 聊天列表页面 -->
        <div class="page page-message" data-page="message">
          <div class="chat-title">聊天</div>
          <!-- 搜索框容器 -->
          <div class="search-container">
            <input type="text" class="search-input" placeholder="搜索好友" />
            <button class="search-button">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
              </svg>
            </button>
          </div>
          <!-- 聊天列表 -->
          <div class="chat-list"></div>
        </div>

        <!-- 聊天详情页面 -->
        <div class="page page-chat-detail" data-page="chat-detail">
          <!-- 聊天详情顶部信息栏 -->
          <div class="chat-detail-info">
            <!-- 返回按钮 -->
            <button class="back-button">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <!-- 头像容器 -->
            <div class="chat-avatar-container">
              <img class="chat-avatar" src="" alt="" />
              <!-- 在线状态圆点 -->
              <div class="online-dot"></div>
            </div>
            <!-- 聊天对象信息 -->
            <div class="chat-info">
              <div class="chat-name"></div>
              <div class="chat-tag"></div>
            </div>
            <!-- 更多按钮 -->
            <button class="more-button">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="5" cy="12" r="1"></circle>
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="19" cy="12" r="1"></circle>
              </svg>
            </button>
          </div>
          <!-- 消息列表容器 -->
          <div class="chat-detail-messages"></div>
          <!-- 底部输入框容器 -->
          <div class="chat-detail-input-container">
            <input
              type="text"
              class="chat-detail-input"
              placeholder="输入消息..."
            />
            <button class="send-button">发送</button>
          </div>
        </div>

        <!-- 觅伴页面 -->
        <div class="page page-find" data-page="find">
          <div class="find-tabs">
            <div class="find-tab active" data-tab="discover">发现</div>
            <div class="find-tab" data-tab="nearby">附近</div>
          </div>
          <div class="find-header-buttons">
            <button class="find-search-button">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
              </svg>
            </button>
            <button class="find-publish-button">发布</button>
          </div>
          <!-- 搜索框 -->
          <div class="find-search-container">
            <div class="find-search-input-wrapper">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
              </svg>
              <input
                type="text"
                class="find-search-input"
                placeholder="搜索活动..."
              />
              <button class="find-search-close">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <!-- 快捷搜索选项 -->
            <div class="find-quick-search">
              <div class="quick-search-title">热门类型</div>
              <div class="quick-search-tags">
                <span class="quick-search-tag" data-type="sport">运动</span>
                <span class="quick-search-tag" data-type="social">社交</span>
                <span class="quick-search-tag" data-type="study">学习</span>
                <span class="quick-search-tag" data-type="dinner">饭局</span>
              </div>
            </div>
            <!-- 搜索结果列表 -->
            <div class="find-search-results"></div>
          </div>
          <div class="find-list-container"></div>
        </div>
        <!-- 觅伴活动详情弹窗遮罩 -->
        <div class="find-detail-overlay"></div>
        <!-- 觅伴活动详情弹窗 -->
        <div class="find-detail-page">
          <div class="find-detail-content"></div>
        </div>
        <!-- 我的页面 -->
        <div class="page page-profile" data-page="profile">
          <div class="profile-header-container">
            <div class="profile-welcome-text">
              <div class="welcome-line">Welcome back，</div>
              <div class="name-line">小玉</div>
            </div>
            <div class="profile-avatar-container">
              <img
                class="profile-avatar"
                src="person/girl4.jpg"
                alt="我的头像"
              />
              <button class="profile-avatar-edit-button">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                  ></path>
                  <circle cx="12" cy="13" r="4"></circle>
                </svg>
              </button>
            </div>
          </div>
          <div class="profile-menu-container">
            <div class="profile-menu-item" data-menu="profile">
              <span>个人资料</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="certification">
              <span>我的认证</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="mypick">
              <span>我的pick</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="pickedme">
              <span>谁pick了我</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="favorites">
              <span>收藏夹</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="preferences">
              <span>推荐偏好筛选</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="partners">
              <span>我的搭子</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="settings">
              <span>设置</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
            <div class="profile-menu-item" data-menu="help">
              <span>帮助与反馈</span>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
        </div>
        <!-- 我的页面详情页 -->
        <div class="page-profile-detail-overlay"></div>
        <div class="page-profile-detail-page">
          <button class="profile-detail-back-button">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <div class="profile-detail-title"></div>
          <div class="profile-detail-content"></div>
        </div>
      </div>

      <!-- 更多菜单遮罩层 -->
      <div class="more-menu-overlay"></div>
      <!-- 更多菜单 -->
      <div class="more-menu">
        <!-- 语音通话菜单项 -->
        <div class="more-menu-item">
          <svg
            class="menu-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
            ></path>
          </svg>
          <span class="menu-label">语音通话</span>
        </div>
        <!-- 视频通话菜单项 -->
        <div class="more-menu-item">
          <svg
            class="menu-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polygon points="23 7 16 12 23 17 23 7"></polygon>
            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
          </svg>
          <span class="menu-label">视频通话</span>
        </div>
        <!-- 取消按钮 -->
        <div class="more-menu-cancel">
          <span>取消</span>
        </div>
      </div>

      <!-- 底部标签栏 -->
      <div class="tab-bar">
        <!-- 推荐标签 -->
        <div class="tab-item active" data-tab="recommend">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polygon
              points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
            ></polygon>
          </svg>
          <span class="tab-label">推荐</span>
        </div>
        <!-- 社区标签 -->
        <div class="tab-item" data-tab="community">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <span class="tab-label">社区</span>
        </div>
        <!-- 消息标签 -->
        <div class="tab-item" data-tab="message">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
            ></path>
          </svg>
          <span class="tab-label">消息</span>
        </div>
        <!-- 觅伴标签 -->
        <div class="tab-item" data-tab="find">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
            ></path>
          </svg>
          <span class="tab-label">觅伴</span>
        </div>
        <!-- 我的标签 -->
        <div class="tab-item" data-tab="profile">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span class="tab-label">我的</span>
        </div>
      </div>
    </div>

    <script>
      // 模拟好友数据数组
      const mockFriends = [
        // 好友1：小明
        {
          id: 1,
          nickname: "小明",
          avatar: "person/boy1.jpg",
          tag: "运动达人",
          is_read: false,
          unread_count: 1,
          is_online: true,
          chat_history: [
            { is_me: false, time: "2026-02-19 14:30", content: "你好！" },
            { is_me: true, time: "2026-02-19 14:31", content: "你好呀！" },
            { is_me: false, time: "2026-02-19 14:32", content: "今天天气不错" },
          ],
        },
        // 好友2：小红
        {
          id: 2,
          nickname: "小红",
          avatar: "person/girl1.jpg",
          tag: "学习搭子",
          is_read: true,
          unread_count: 0,
          is_online: false,
          chat_history: [
            { is_me: true, time: "2026-02-18 19:20", content: "明天有空吗？" },
            {
              is_me: false,
              time: "2026-02-18 19:25",
              content: "有的，什么事？",
            },
          ],
        },
        // 好友3：小李
        {
          id: 3,
          nickname: "小李",
          avatar: "person/boy2.jpg",
          tag: "摄影爱好者",
          is_read: false,
          unread_count: 1,
          is_online: true,
          chat_history: [
            {
              is_me: false,
              time: "2026-02-19 10:15",
              content: "周末一起去爬山吧",
            },
          ],
        },
        // 好友4：小王
        {
          id: 4,
          nickname: "小王",
          avatar: "person/boy3.jpg",
          tag: "美食博主",
          is_read: true,
          unread_count: 0,
          is_online: true,
          chat_history: [
            {
              is_me: true,
              time: "2026-02-17 16:45",
              content: "收到了，谢谢！",
            },
            { is_me: false, time: "2026-02-17 16:46", content: "不客气～" },
          ],
        },
        // 好友5：小张
        {
          id: 5,
          nickname: "小张",
          avatar: "person/girl2.jpg",
          tag: "旅行达人",
          is_read: false,
          unread_count: 2,
          is_online: false,
          chat_history: [
            { is_me: false, time: "2026-02-19 09:00", content: "早上好！" },
            { is_me: false, time: "2026-02-19 09:05", content: "今天记得开会" },
          ],
        },
        // 好友6：小赵
        {
          id: 6,
          nickname: "小赵",
          avatar: "person/girl3.jpg",
          tag: "音乐爱好者",
          is_read: true,
          unread_count: 0,
          is_online: true,
          chat_history: [
            { is_me: true, time: "2026-02-16 21:30", content: "晚安" },
            { is_me: false, time: "2026-02-16 21:32", content: "晚安，好梦！" },
          ],
        },
      ];

      // 当前tab页面状态（只记录五个主tab）
      let currentTab = "recommend";
      // 上一个tab页面状态
      let previousTab = "recommend";
      // 聊天详情页是否打开
      let chatDetailOpen = false;
      // 标签项元素集合
      const tabItems = document.querySelectorAll(".tab-item");
      // 页面元素集合
      const pages = document.querySelectorAll(".page");
      // 标签栏元素
      const tabBar = document.querySelector(".tab-bar");
      // 五个tab页面的顺序
      const tabOrder = ["recommend", "community", "message", "find", "profile"];

      // 按最后消息时间排序好友
      function sortFriendsByTime(friends) {
        return [...friends].sort((a, b) => {
          // 获取好友的最后消息时间
          const getLastTime = (f) => {
            if (f.chat_history && f.chat_history.length > 0) {
              return new Date(f.chat_history[f.chat_history.length - 1].time);
            }
            return new Date(0);
          };
          // 降序排列
          return getLastTime(b) - getLastTime(a);
        });
      }

      // 渲染聊天列表
      function renderChatList(friends) {
        const chatList = document.querySelector(".chat-list");
        chatList.innerHTML = "";

        // 先按时间排序
        const sortedFriends = sortFriendsByTime(friends);

        // 遍历每个好友创建列表项
        sortedFriends.forEach((friend) => {
          const lastMessage =
            friend.chat_history[friend.chat_history.length - 1];
          const chatItem = document.createElement("div");
          chatItem.className = "chat-item";

          // 构建聊天项HTML
          chatItem.innerHTML = `
                    <div class="chat-avatar-container">
                        <img class="chat-avatar" src="${friend.avatar}" alt="${friend.nickname}">
                        ${friend.is_online ? '<div class="online-dot"></div>' : ""}
                    </div>
                    <div class="chat-info">
                        <div class="chat-name">${friend.nickname}</div>
                        <div class="chat-message">${lastMessage ? lastMessage.content : ""}</div>
                    </div>
                    ${friend.unread_count > 0 ? `<div class="unread-badge">${friend.unread_count}</div>` : ""}
                `;

          // 添加点击事件，打开聊天详情
          chatItem.addEventListener("click", () => openChatDetail(friend));
          chatList.appendChild(chatItem);
        });
      }

      // 打开聊天详情页
      function openChatDetail(friend) {
        // 先关闭更多菜单
        hideMoreMenu();

        // 设置头像
        const avatarImg = document.querySelector(
          ".chat-detail-info .chat-avatar",
        );
        avatarImg.src = friend.avatar;
        avatarImg.alt = friend.nickname;

        // 设置在线状态
        const onlineDot = document.querySelector(
          ".chat-detail-info .online-dot",
        );
        if (friend.is_online) {
          onlineDot.style.display = "block";
        } else {
          onlineDot.style.display = "none";
        }

        // 设置昵称和标签
        document.querySelector(".chat-detail-info .chat-name").textContent =
          friend.nickname;
        document.querySelector(".chat-detail-info .chat-tag").textContent =
          friend.tag;

        // 渲染消息列表
        const messagesContainer = document.querySelector(
          ".chat-detail-messages",
        );
        messagesContainer.innerHTML = "";

        // 遍历聊天历史
        friend.chat_history.forEach((msg) => {
          const messageItem = document.createElement("div");
          messageItem.className = `message-item ${msg.is_me ? "message-me" : "message-other"}`;

          let avatarImg = "";
          if (!msg.is_me) {
            avatarImg = `<img class="message-avatar" src="${friend.avatar}" alt="${friend.nickname}">`;
          } else {
            avatarImg = `<img class="message-avatar" src="person/girl4.jpg" alt="我">`;
          }

          // 提取时间部分
          const timeStr = msg.time.split(" ")[1];

          // 根据是否是我的消息构建不同的HTML结构
          if (msg.is_me) {
            messageItem.innerHTML = `
                        <div class="message-content">
                            <div class="message-bubble">${msg.content}</div>
                            <div class="message-time message-time-me">${timeStr}</div>
                        </div>
                        ${avatarImg}
                    `;
          } else {
            messageItem.innerHTML = `
                        ${avatarImg}
                        <div class="message-content">
                            <div class="message-bubble">${msg.content}</div>
                            <div class="message-time">${timeStr}</div>
                        </div>
                    `;
          }
          messagesContainer.appendChild(messageItem);
        });

        // 滚动到底部
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // 隐藏所有主tab页面
        tabOrder.forEach((tab) => {
          const pageEl = document.querySelector(`.page-${tab}`);
          if (pageEl) {
            pageEl.classList.remove(
              "active",
              "from-right",
              "from-left",
              "to-right",
              "to-left",
            );
          }
        });

        // 聊天详情页从右侧滑入 - 完全独立的逻辑
        const chatDetailPage = document.querySelector(".page-chat-detail");
        chatDetailPage.classList.remove(
          "active",
          "from-right",
          "from-left",
          "to-right",
          "to-left",
        );
        chatDetailPage.classList.add("from-right");
        chatDetailPage.classList.add("active");

        chatDetailOpen = true;
        tabBar.style.display = "none";
      }

      // 关闭聊天详情页
      function closeChatDetail() {
        // 先关闭更多菜单
        hideMoreMenu();

        // 聊天详情页向右侧滑出 - 完全独立的逻辑
        const chatDetailPage = document.querySelector(".page-chat-detail");
        chatDetailPage.classList.remove(
          "active",
          "from-right",
          "from-left",
          "to-right",
          "to-left",
        );
        chatDetailPage.classList.add("to-right");

        // 等待动画完成后再隐藏
        setTimeout(() => {
          chatDetailPage.classList.remove("active", "to-right");
        }, 300);

        chatDetailOpen = false;
        tabBar.style.display = "flex";

        // 确保当前tab页面保持显示
        const currentTabPage = document.querySelector(`.page-${currentTab}`);
        if (currentTabPage) {
          currentTabPage.classList.add("active");
        }

        initChatPage();
      }

      // 初始化聊天页面
      function initChatPage() {
        renderChatList(mockFriends);
      }

      // 切换tab页面 - 只处理五个主tab之间的切换
      function switchTab(targetTab) {
        if (currentTab === targetTab) return;

        previousTab = currentTab;
        currentTab = targetTab;

        // 清除所有tab页面的动画类
        tabOrder.forEach((tab) => {
          const pageEl = document.querySelector(`.page-${tab}`);
          if (pageEl) {
            pageEl.classList.remove(
              "active",
              "from-right",
              "from-left",
              "to-right",
              "to-left",
            );
          }
        });

        const prevIndex = tabOrder.indexOf(previousTab);
        const targetIndex = tabOrder.indexOf(targetTab);

        const prevPageEl = document.querySelector(`.page-${previousTab}`);
        const targetPageEl = document.querySelector(`.page-${targetTab}`);

        // 只有相邻的两个tab切换时才使用滑动动画
        if (Math.abs(prevIndex - targetIndex) === 1) {
          if (targetIndex > prevIndex) {
            // 向右滑动 - 目标页面从右侧滑入
            targetPageEl.classList.add("from-right");
          } else {
            // 向左滑动 - 目标页面从左侧滑入
            targetPageEl.classList.add("from-left");
          }
        }

        targetPageEl.classList.add("active");

        if (targetTab === "message") {
          initChatPage();
        } else if (targetTab === "community") {
          initCommunityPage();
        } else if (targetTab === "profile") {
          initProfilePage();
        } else if (targetTab === "find") {
          initFindPage();
        }
      }

      // 获取搜索相关元素
      const searchButton = document.querySelector(".search-button");
      const searchInput = document.querySelector(".search-input");

      // 搜索按钮点击事件
      searchButton.addEventListener("click", () => {
        const keyword = searchInput.value.trim();
        if (keyword) {
          renderChatList(
            mockFriends.filter((f) => f.nickname.includes(keyword)),
          );
        } else {
          renderChatList(mockFriends);
        }
      });

      // 搜索框回车事件
      searchInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          const keyword = searchInput.value.trim();
          if (keyword) {
            renderChatList(
              mockFriends.filter((f) => f.nickname.includes(keyword)),
            );
          } else {
            renderChatList(mockFriends);
          }
        }
      });

      // 返回按钮点击事件
      document.querySelector(".back-button").addEventListener("click", () => {
        closeChatDetail();
      });

      // 获取更多菜单相关元素
      const moreButton = document.querySelector(".more-button");
      const moreMenuOverlay = document.querySelector(".more-menu-overlay");
      const moreMenu = document.querySelector(".more-menu");
      const moreMenuCancel = document.querySelector(".more-menu-cancel");

      // 显示更多菜单
      function showMoreMenu() {
        moreMenuOverlay.classList.add("active");
        moreMenu.classList.add("active");
      }

      // 隐藏更多菜单
      function hideMoreMenu() {
        moreMenuOverlay.classList.remove("active");
        moreMenu.classList.remove("active");
      }

      // 绑定更多菜单事件
      moreButton.addEventListener("click", showMoreMenu);
      moreMenuOverlay.addEventListener("click", hideMoreMenu);
      moreMenuCancel.addEventListener("click", hideMoreMenu);

      // 标签栏点击事件
      tabItems.forEach((item) => {
        item.addEventListener("click", () => {
          const targetTab = item.dataset.tab;

          // 如果聊天详情页打开，先关闭
          if (chatDetailOpen) {
            closeChatDetail();
            // 延迟一点时间再切换tab，确保动画不冲突
            setTimeout(() => {
              if (currentTab !== targetTab) {
                tabItems.forEach((tab) => tab.classList.remove("active"));
                item.classList.add("active");
                switchTab(targetTab);
              }
            }, 300);
            return;
          }

          if (currentTab !== targetTab) {
            tabItems.forEach((tab) => tab.classList.remove("active"));
            item.classList.add("active");
            switchTab(targetTab);
          }
        });
      });

      // 人物详细数据
      const personDetailData = [
        {
          index: 0,
          name: "小雪",
          basic: "女 · 22岁",
          image: "recommend/girl-skiing.jpg",
          desc: "还记得那个冬天的滑雪场吗？阳光洒在雪地上，闪闪发光，就像你那双爱笑的眼睛。你说你最喜欢冬天，因为可以在雪地里自由滑行，感受风从耳边呼啸而过的感觉。每次摔倒你都会笑着爬起来，拍拍身上的雪说：「这可是滑雪的必修课呀！」你的乐观感染了身边的每一个人，和你在一起的每一天都像是在过节。",
          isFavorited: false,
        },
        {
          index: 1,
          name: "小琳",
          basic: "女 · 23岁",
          image: "recommend/girl-photoing.jpg",
          desc: "摄影是你记录生活的方式，也是你与世界对话的语言。你总说：「最好的照片不是拍出来的，而是等出来的。」于是你愿意在清晨的山顶等待日出，在黄昏的海边守候日落，在雨后的巷子里捕捉那道转瞬即逝的彩虹。你的相机里装满了故事，每一张照片背后都有一段温暖的回忆。",
          isFavorited: false,
        },
        {
          index: 2,
          name: "小美",
          basic: "女 · 23岁",
          image: "recommend/girl-shopping.jpg",
          desc: "逛街对你来说从来不是一项任务，而是一场发现美的冒险。你总能在琳琅满目的店铺里发现那些被别人忽略的小美好——也许是一条别致的项链，也许是一件设计独特的衣服，也许只是一杯好看的奶茶。你说：「生活中不缺少美，缺少的是发现美的眼睛和愿意停下来欣赏的心情。」",
          isFavorited: false,
        },
        {
          index: 3,
          name: "小宇",
          basic: "男 · 24岁",
          image: "recommend/boy-badminton.jpg",
          desc: "羽毛球场上的你总是那么耀眼，每一次挥拍都充满了力量与美感。你说打球不仅是为了锻炼身体，更是为了释放压力，享受那种挥汗如雨的畅快。每周五的晚上是你固定的球友时间，不管工作多忙你都会准时出现。你常说：「生活就像打羽毛球，你永远不知道下一个球会从哪里来，但你只要准备好，就一定能接得住。」",
          isFavorited: false,
        },
      ];

      // 获取推荐标签元素
      const recommendTabs = document.querySelectorAll(".recommend-tab");

      // 推荐标签点击事件
      recommendTabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          recommendTabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");
        });
      });

      // 打开卡片详情页
      function openCardDetail(personIndex) {
        const person = personDetailData[personIndex];
        if (!person) return;

        // 设置详情页内容
        document.querySelector(".card-detail-image").src = person.image;
        document.querySelector(".card-detail-image").alt = person.name;
        document.querySelector(".card-detail-name").textContent = person.name;
        document.querySelector(".card-detail-basic").textContent = person.basic;
        document.querySelector(".card-detail-desc").textContent = person.desc;

        // 显示详情页
        document.querySelector(".card-detail-overlay").classList.add("active");
        document.querySelector(".card-detail-page").classList.add("active");
      }

      // 关闭卡片详情页
      function closeCardDetail() {
        document
          .querySelector(".card-detail-overlay")
          .classList.remove("active");
        document.querySelector(".card-detail-page").classList.remove("active");
      }

      // 卡片堆栈管理
      let cardStack = [0, 1, 2, 3]; // 当前可见的卡片索引顺序
      let cardHistory = []; // 历史记录，用于返回功能，保存 {stack, direction}
      let isAnimating = false;

      // 更新卡片样式
      function updateCards() {
        const cards = document.querySelectorAll(".recommend-card");
        cards.forEach((card) => {
          card.classList.remove(
            "recommend-card-front",
            "recommend-card-back-1",
            "recommend-card-back-2",
            "recommend-card-back-3",
          );
        });

        // 设置前三个可见卡片
        if (cardStack.length > 0) {
          const frontCard = document.querySelector(
            `.recommend-card[data-index="${cardStack[0]}"]`,
          );
          if (frontCard) frontCard.classList.add("recommend-card-front");
        }
        if (cardStack.length > 1) {
          const back1Card = document.querySelector(
            `.recommend-card[data-index="${cardStack[1]}"]`,
          );
          if (back1Card) back1Card.classList.add("recommend-card-back-1");
        }
        if (cardStack.length > 2) {
          const back2Card = document.querySelector(
            `.recommend-card[data-index="${cardStack[2]}"]`,
          );
          if (back2Card) back2Card.classList.add("recommend-card-back-2");
        }
        if (cardStack.length > 3) {
          const back3Card = document.querySelector(
            `.recommend-card[data-index="${cardStack[3]}"]`,
          );
          if (back3Card) back3Card.classList.add("recommend-card-back-3");
        }
      }

      // 移除最前面的卡片
      function removeFrontCard(direction) {
        if (cardStack.length === 0 || isAnimating) return;

        isAnimating = true;

        // 保存历史，包括滑出方向
        cardHistory.push({ stack: [...cardStack], direction: direction });

        const frontCard = document.querySelector(
          `.recommend-card[data-index="${cardStack[0]}"]`,
        );
        if (frontCard) {
          frontCard.style.transition = "all 0.3s ease";

          // 根据方向设置滑出动画
          if (direction === "left") {
            frontCard.style.transform = "translateX(-120%) rotate(-10deg)";
          } else {
            frontCard.style.transform = "translateX(120%) rotate(10deg)";
          }
          frontCard.style.opacity = "0";

          setTimeout(() => {
            // 移除最前面的卡片
            cardStack.shift();
            frontCard.style.transition = "";
            frontCard.style.transform = "";
            frontCard.style.opacity = "";
            updateCards();
            isAnimating = false;
          }, 300);
        } else {
          isAnimating = false;
        }
      }

      // 返回上一个卡片
      function restoreCard() {
        if (cardHistory.length === 0 || isAnimating) return;

        isAnimating = true;

        // 恢复历史状态
        const historyItem = cardHistory.pop();
        cardStack = historyItem.stack;
        const direction = historyItem.direction;

        updateCards();

        const frontCard = document.querySelector(
          `.recommend-card[data-index="${cardStack[0]}"]`,
        );
        if (frontCard) {
          frontCard.style.transition = "";

          // 根据原来的滑出方向，从相反方向滑入
          if (direction === "left") {
            frontCard.style.transform = "translateX(-120%) rotate(-10deg)";
          } else {
            frontCard.style.transform = "translateX(120%) rotate(10deg)";
          }
          frontCard.style.opacity = "0";

          setTimeout(() => {
            frontCard.style.transition = "all 0.3s ease";
            frontCard.style.transform = "";
            frontCard.style.opacity = "";

            setTimeout(() => {
              frontCard.style.transition = "";
              isAnimating = false;
            }, 300);
          }, 50);
        } else {
          isAnimating = false;
        }
      }

      // 操作按钮点击事件
      const actionButtons = document.querySelectorAll(".action-button");
      actionButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const action = button.dataset.action;

          switch (action) {
            case "back":
              restoreCard();
              break;
            case "dislike":
              // 不感兴趣，左滑出
              removeFrontCard("left");
              break;
            case "like":
              // 喜欢，右滑出
              removeFrontCard("right");
              break;
            case "favorite":
              // 收藏，只切换状态，不划走卡片
              if (cardStack.length > 0) {
                const currentPersonIndex = cardStack[0];
                const person = personDetailData[currentPersonIndex];
                if (person) {
                  person.isFavorited = !person.isFavorited;
                  // 更新按钮样式
                  updateFavoriteButtonStyle(currentPersonIndex);
                }
              }
              break;
          }
        });
      });

      // 更新收藏按钮样式
      function updateFavoriteButtonStyle(personIndex) {
        const person = personDetailData[personIndex];
        const favoriteButton = document.querySelector(
          ".action-button-favorite",
        );
        if (person && favoriteButton) {
          if (person.isFavorited) {
            favoriteButton
              .querySelector("svg")
              .setAttribute("fill", "currentColor");
            favoriteButton.style.transform = "scale(1.1)";
            setTimeout(() => {
              favoriteButton.style.transform = "scale(1)";
            }, 200);
          } else {
            favoriteButton.querySelector("svg").setAttribute("fill", "none");
          }
        }
      }

      // 在更新卡片时也更新收藏按钮状态
      const originalUpdateCards = updateCards;
      updateCards = function () {
        originalUpdateCards();
        if (cardStack.length > 0) {
          updateFavoriteButtonStyle(cardStack[0]);
        }
      };

      // 卡片点击事件 - 打开详情页
      const cards = document.querySelectorAll(".recommend-card");
      cards.forEach((card) => {
        card.addEventListener("click", (e) => {
          // 如果卡片不在最前面，不响应点击
          if (!card.classList.contains("recommend-card-front")) return;

          const index = parseInt(card.dataset.index);
          openCardDetail(index);
        });
      });

      // 详情页返回按钮点击事件
      document
        .querySelector(".card-detail-back-button")
        .addEventListener("click", closeCardDetail);

      // 点击遮罩层关闭详情页
      document
        .querySelector(".card-detail-overlay")
        .addEventListener("click", closeCardDetail);

      // 社区发布数据
      const communityPosts = [
        {
          id: 1,
          author: {
            nickname: "小明",
            avatar: "person/boy1.jpg",
          },
          club: "自行车",
          clubTag: "bicycleclub",
          content:
            "今天天气真好！和俱乐部的小伙伴们一起骑行去郊外，沿途的风景太美了～",
          images: [
            "clubs/bicycleclub/15cd-c8a4f38ac0895c6e11d04ddd3410955c.jpg",
            "clubs/bicycleclub/IMG_20241110_121547.jpg",
            "clubs/bicycleclub/IMG_20241110_132523.jpg",
          ],
          time: "2小时前",
          likes: 32,
          favorites: 8,
          isLiked: false,
          isFavorited: false,
        },
        {
          id: 2,
          author: {
            nickname: "小红",
            avatar: "person/girl1.jpg",
          },
          club: "美食",
          clubTag: "foodclub",
          content:
            "周末和闺蜜探店成功！这家店的摆盘太精致了，每一道菜都是艺术品～",
          images: [
            "clubs/foodclub/IMG_20250603_183836.jpg",
            "clubs/foodclub/IMG_20250623_191252.jpg",
            "clubs/foodclub/IMG_20250720_153904.jpg",
          ],
          time: "5小时前",
          likes: 45,
          favorites: 12,
          isLiked: false,
          isFavorited: false,
        },
        {
          id: 3,
          author: {
            nickname: "小李",
            avatar: "person/boy2.jpg",
          },
          club: "旅行",
          clubTag: "travelclub",
          content:
            "终于来到了心心念念的山间！云雾缭绕，仿佛置身仙境，这一刻所有的烦恼都烟消云散了。",
          images: [
            "clubs/travelclub/mountain-9423779_1280.jpg",
            "clubs/travelclub/mountains-1113547_1280.jpg",
            "clubs/travelclub/road-8157300_1280.jpg",
          ],
          time: "昨天",
          likes: 68,
          favorites: 21,
          isLiked: false,
          isFavorited: false,
        },
        {
          id: 4,
          author: {
            nickname: "小王",
            avatar: "person/boy3.jpg",
          },
          club: "自行车",
          clubTag: "bicycleclub",
          content:
            "夜骑结束！城市的夜景别有一番风味，晚风拂面，感觉整个人都放松了。",
          images: [
            "clubs/bicycleclub/IMG_20241110_121547.jpg",
            "clubs/bicycleclub/15cd-c8a4f38ac0895c6e11d04ddd3410955c.jpg",
            "clubs/bicycleclub/IMG_20241110_132523.jpg",
          ],
          time: "2天前",
          likes: 25,
          favorites: 6,
          isLiked: false,
          isFavorited: false,
        },
      ];

      // 渲染社区页面
      function renderCommunityList() {
        const communityList = document.querySelector(".community-list");
        communityList.innerHTML = "";

        communityPosts.forEach((post) => {
          const postCard = document.createElement("div");
          postCard.className = "community-post-card";

          postCard.innerHTML = `
                    <div class="community-post-header">
                        <div class="community-avatar-container">
                            <img class="community-avatar" src="${post.author.avatar}" alt="${post.author.nickname}">
                        </div>
                        <div class="community-author-info">
                            <div class="community-author-name">${post.author.nickname}</div>
                        </div>
                        <div class="community-tag">${post.club}</div>
                    </div>
                    <div class="community-post-content" data-post-id="${post.id}">${post.content}</div>
                    <div class="community-post-images">
                        <img class="community-post-image" src="${post.images[0]}" alt="" data-post-id="${post.id}" data-image-index="0">
                        <img class="community-post-image" src="${post.images[1]}" alt="" data-post-id="${post.id}" data-image-index="1">
                        <img class="community-post-image" src="${post.images[2]}" alt="" data-post-id="${post.id}" data-image-index="2">
                    </div>
                    <div class="community-post-footer">
                        <div class="community-post-time">${post.time}</div>
                        <div class="community-post-stats">
                            <div class="community-stat-item community-like-button ${post.isLiked ? "active" : ""}" data-post-id="${post.id}" data-action="like">
                                <svg viewBox="0 0 24 24" fill="${post.isLiked ? "currentColor" : "none"}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                                <span>${post.likes}</span>
                            </div>
                            <div class="community-stat-item community-favorite-button ${post.isFavorited ? "active" : ""}" data-post-id="${post.id}" data-action="favorite">
                                <svg viewBox="0 0 24 24" fill="${post.isFavorited ? "currentColor" : "none"}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                                <span>${post.favorites}</span>
                            </div>
                        </div>
                    </div>
                `;

          communityList.appendChild(postCard);
        });

        // 绑定图片点击事件
        document.querySelectorAll(".community-post-image").forEach((img) => {
          img.addEventListener("click", (e) => {
            const postId = parseInt(img.dataset.postId);
            const imageIndex = parseInt(img.dataset.imageIndex);
            openCommunityImage(postId, imageIndex);
          });
        });

        // 绑定文本点击事件
        document
          .querySelectorAll(".community-post-content")
          .forEach((content) => {
            content.addEventListener("click", (e) => {
              const postId = parseInt(content.dataset.postId);
              openCommunityPostDetail(postId);
            });
          });

        // 绑定点赞和收藏点击事件
        document.querySelectorAll(".community-like-button").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const postId = parseInt(btn.dataset.postId);
            toggleLike(postId);
          });
        });

        document
          .querySelectorAll(".community-favorite-button")
          .forEach((btn) => {
            btn.addEventListener("click", (e) => {
              e.stopPropagation();
              const postId = parseInt(btn.dataset.postId);
              toggleFavorite(postId);
            });
          });
      }

      // 打开社区图片放大查看
      function openCommunityImage(postId, imageIndex) {
        const post = communityPosts.find((p) => p.id === postId);
        if (!post) return;

        document.querySelector(".community-viewer-image").src =
          post.images[imageIndex];
        document
          .querySelector(".community-image-overlay")
          .classList.add("active");
        document
          .querySelector(".community-image-viewer")
          .classList.add("active");
      }

      // 关闭社区图片放大查看
      function closeCommunityImage() {
        document
          .querySelector(".community-image-overlay")
          .classList.remove("active");
        document
          .querySelector(".community-image-viewer")
          .classList.remove("active");
      }

      // 切换点赞状态
      function toggleLike(postId) {
        const post = communityPosts.find((p) => p.id === postId);
        if (!post) return;

        post.isLiked = !post.isLiked;
        post.likes += post.isLiked ? 1 : -1;

        // 更新列表中的显示
        updatePostStats(postId);
      }

      // 切换收藏状态
      function toggleFavorite(postId) {
        const post = communityPosts.find((p) => p.id === postId);
        if (!post) return;

        post.isFavorited = !post.isFavorited;
        post.favorites += post.isFavorited ? 1 : -1;

        // 更新列表中的显示
        updatePostStats(postId);
      }

      // 更新发布卡片的统计显示
      function updatePostStats(postId) {
        const post = communityPosts.find((p) => p.id === postId);
        if (!post) return;

        // 更新列表中的卡片
        const listLikeButtons = document.querySelectorAll(
          `.community-like-button[data-post-id="${postId}"]`,
        );
        listLikeButtons.forEach((btn) => {
          btn.classList.toggle("active", post.isLiked);
          const svg = btn.querySelector("svg");
          svg.setAttribute("fill", post.isLiked ? "currentColor" : "none");
          const span = btn.querySelector("span");
          span.textContent = post.likes;
        });

        const listFavoriteButtons = document.querySelectorAll(
          `.community-favorite-button[data-post-id="${postId}"]`,
        );
        listFavoriteButtons.forEach((btn) => {
          btn.classList.toggle("active", post.isFavorited);
          const svg = btn.querySelector("svg");
          svg.setAttribute("fill", post.isFavorited ? "currentColor" : "none");
          const span = btn.querySelector("span");
          span.textContent = post.favorites;
        });
      }

      // 打开社区发布详情页
      function openCommunityPostDetail(postId) {
        const post = communityPosts.find((p) => p.id === postId);
        if (!post) return;

        const detailContent = document.querySelector(
          ".community-post-detail-content",
        );
        detailContent.innerHTML = `
                    <div class="community-post-header" style="margin-bottom: 20px;">
                        <div class="community-avatar-container">
                            <img class="community-avatar" src="${post.author.avatar}" alt="${post.author.nickname}">
                        </div>
                        <div class="community-author-info">
                            <div class="community-author-name">${post.author.nickname}</div>
                        </div>
                        <div class="community-tag">${post.club}</div>
                    </div>
                    <div class="community-post-content" style="margin-bottom: 20px; cursor: default;">${post.content}</div>
                    <div class="community-post-images" style="margin-bottom: 20px;">
                        <img class="community-post-image" src="${post.images[0]}" alt="" data-post-id="${post.id}" data-image-index="0">
                        <img class="community-post-image" src="${post.images[1]}" alt="" data-post-id="${post.id}" data-image-index="1">
                        <img class="community-post-image" src="${post.images[2]}" alt="" data-post-id="${post.id}" data-image-index="2">
                    </div>
                    <div class="community-post-footer">
                        <div class="community-post-time">${post.time}</div>
                        <div class="community-post-stats">
                            <div class="community-stat-item community-like-button ${post.isLiked ? "active" : ""}" data-post-id="${post.id}" data-action="like">
                                <svg viewBox="0 0 24 24" fill="${post.isLiked ? "currentColor" : "none"}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                                <span>${post.likes}</span>
                            </div>
                            <div class="community-stat-item community-favorite-button ${post.isFavorited ? "active" : ""}" data-post-id="${post.id}" data-action="favorite">
                                <svg viewBox="0 0 24 24" fill="${post.isFavorited ? "currentColor" : "none"}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                                <span>${post.favorites}</span>
                            </div>
                        </div>
                    </div>
                `;

        document
          .querySelector(".community-post-detail-overlay")
          .classList.add("active");
        document
          .querySelector(".community-post-detail-page")
          .classList.add("active");

        // 绑定详情页图片点击事件
        document
          .querySelectorAll(".community-post-detail-page .community-post-image")
          .forEach((img) => {
            img.addEventListener("click", (e) => {
              const postId = parseInt(img.dataset.postId);
              const imageIndex = parseInt(img.dataset.imageIndex);
              openCommunityImage(postId, imageIndex);
            });
          });

        // 绑定详情页点赞和收藏点击事件
        document
          .querySelectorAll(
            ".community-post-detail-page .community-like-button",
          )
          .forEach((btn) => {
            btn.addEventListener("click", (e) => {
              e.stopPropagation();
              const postId = parseInt(btn.dataset.postId);
              toggleLike(postId);
            });
          });

        document
          .querySelectorAll(
            ".community-post-detail-page .community-favorite-button",
          )
          .forEach((btn) => {
            btn.addEventListener("click", (e) => {
              e.stopPropagation();
              const postId = parseInt(btn.dataset.postId);
              toggleFavorite(postId);
            });
          });
      }

      // 关闭社区发布详情页
      function closeCommunityPostDetail() {
        document
          .querySelector(".community-post-detail-overlay")
          .classList.remove("active");
        document
          .querySelector(".community-post-detail-page")
          .classList.remove("active");
      }

      // 社区事件是否已绑定
      let communityEventsBound = false;

      // 初始化社区页面
      function initCommunityPage() {
        renderCommunityList();

        if (!communityEventsBound) {
          // 绑定图片查看器关闭事件
          document
            .querySelector(".community-image-close")
            .addEventListener("click", closeCommunityImage);
          document
            .querySelector(".community-image-overlay")
            .addEventListener("click", closeCommunityImage);

          // 绑定发布详情页关闭事件
          document
            .querySelector(".community-post-detail-close")
            .addEventListener("click", closeCommunityPostDetail);
          document
            .querySelector(".community-post-detail-overlay")
            .addEventListener("click", closeCommunityPostDetail);

          communityEventsBound = true;
        }
      }

      // 菜单名称映射
      const menuNames = {
        profile: "个人资料",
        certification: "我的认证",
        mypick: "我的pick",
        pickedme: "谁pick了我",
        favorites: "收藏夹",
        preferences: "推荐偏好筛选",
        partners: "我的搭子",
        settings: "设置",
        help: "帮助与反馈",
      };

      // 渲染收藏夹内容
      function renderFavorites() {
        const detailContent = document.querySelector(".profile-detail-content");
        let html = "";

        // 收集所有收藏的社区发布
        const favoritePosts = communityPosts.filter((p) => p.isFavorited);
        // 收集所有收藏的推荐人物
        const favoritePersons = personDetailData.filter((p) => p.isFavorited);

        if (favoritePosts.length === 0 && favoritePersons.length === 0) {
          html = `
            <div style="text-align: center; padding: 60px 0;">
              <div style="font-size: 60px; margin-bottom: 20px;">📭</div>
              <div style="font-size: 16px; color: #a3a1bf;">还没有收藏内容哦～</div>
            </div>
          `;
        } else {
          // 添加收藏的推荐人物
          if (favoritePersons.length > 0) {
            html += `<div style="font-size: 16px; font-weight: bold; color: #333; margin-bottom: 15px; margin-top: 10px;">推荐人物</div>`;
            favoritePersons.forEach((person) => {
              html += `
                <div class="favorite-item" style="display: flex; align-items: center; padding: 12px; background: #fff; border-radius: 12px; margin-bottom: 12px;">
                  <img src="${person.image}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-right: 12px;">
                  <div style="flex: 1;">
                    <div style="font-size: 16px; font-weight: 500; color: #333; margin-bottom: 4px;">${person.name}</div>
                    <div style="font-size: 13px; color: #666;">${person.basic}</div>
                  </div>
                  <button class="favorite-remove-btn" data-type="person" data-index="${person.index}" style="background: none; border: none; cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 20px; height: 20px;">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
              `;
            });
          }

          // 添加收藏的社区发布
          if (favoritePosts.length > 0) {
            html += `<div style="font-size: 16px; font-weight: bold; color: #333; margin-bottom: 15px; margin-top: 20px;">社区发布</div>`;
            favoritePosts.forEach((post) => {
              html += `
                <div class="favorite-item" style="padding: 12px; background: #fff; border-radius: 12px; margin-bottom: 12px;">
                  <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                    <div style="display: flex; align-items: center;">
                      <img src="${post.author.avatar}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 10px;">
                      <div>
                        <div style="font-size: 14px; font-weight: 500; color: #333;">${post.author.nickname}</div>
                        <div style="font-size: 12px; color: #a3a1bf;">${post.club} · ${post.time}</div>
                      </div>
                    </div>
                    <button class="favorite-remove-btn" data-type="post" data-id="${post.id}" style="background: none; border: none; cursor: pointer; padding: 4px; border-radius: 50%; transition: all 0.2s;">
                      <svg viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 18px; height: 18px;">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                    </button>
                  </div>
                  <div style="font-size: 14px; color: #333; line-height: 1.5; margin-bottom: 8px;">${post.content}</div>
                  <div style="display: flex; gap: 8px;">
                    ${post.images
                      .slice(0, 3)
                      .map(
                        (img, i) => `
                      <img src="${img}" style="width: 70px; height: 70px; border-radius: 8px; object-fit: cover;">
                    `,
                      )
                      .join("")}
                  </div>
                </div>
              `;
            });
          }
        }

        detailContent.innerHTML = html;

        // 绑定取消收藏按钮事件
        document.querySelectorAll(".favorite-remove-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const type = btn.dataset.type;
            if (type === "person") {
              const index = parseInt(btn.dataset.index);
              const person = personDetailData.find((p) => p.index === index);
              if (person) {
                person.isFavorited = false;
              }
            } else if (type === "post") {
              const id = parseInt(btn.dataset.id);
              const post = communityPosts.find((p) => p.id === id);
              if (post) {
                post.isFavorited = false;
                post.favorites--;
                // 更新社区页面显示
                updatePostStats(id);
              }
            }
            // 重新渲染收藏夹
            renderFavorites();
          });
        });
      }

      // 打开我的页面详情
      function openProfileDetail(menuId) {
        const title = menuNames[menuId] || "详情";
        document.querySelector(".profile-detail-title").textContent = title;

        const detailContent = document.querySelector(".profile-detail-content");

        if (menuId === "favorites") {
          renderFavorites();
        } else {
          detailContent.innerHTML = `
            <div style="text-align: center; padding: 40px 0;">
              <div style="font-size: 18px; color: #333; margin-bottom: 10px;">${title}</div>
              <div style="font-size: 14px; color: #a3a1bf;">功能开发中...</div>
            </div>
          `;
        }

        document
          .querySelector(".page-profile-detail-overlay")
          .classList.add("active");
        document
          .querySelector(".page-profile-detail-page")
          .classList.add("active");
      }

      // 关闭我的页面详情
      function closeProfileDetail() {
        document
          .querySelector(".page-profile-detail-overlay")
          .classList.remove("active");
        document
          .querySelector(".page-profile-detail-page")
          .classList.remove("active");
      }

      // 初始化我的页面
      function initProfilePage() {
        // 绑定菜单项点击事件
        document.querySelectorAll(".profile-menu-item").forEach((item) => {
          item.addEventListener("click", () => {
            const menuId = item.dataset.menu;
            openProfileDetail(menuId);
          });
        });

        // 绑定返回按钮点击事件
        document
          .querySelector(".profile-detail-back-button")
          .addEventListener("click", closeProfileDetail);

        // 绑定遮罩层点击事件
        document
          .querySelector(".page-profile-detail-overlay")
          .addEventListener("click", closeProfileDetail);
      }

      // 觅伴活动数据
      const findActivities = [
        {
          id: 1,
          author: {
            nickname: "小明",
            avatar: "person/boy1.jpg",
          },
          title: "小明的羽毛球局",
          tags: [
            { name: "运动", type: "sport" },
            { name: "羽毛球", type: "badminton" },
          ],
          people: {
            current: 3,
            total: 6,
          },
          authRequired: "仅限认证",
          cost: "AA制",
          time: "2026.5.1 13:30 2h",
          location: "城市运动中心羽毛球馆",
          status: "ongoing",
          isJoined: false,
        },
        {
          id: 2,
          author: {
            nickname: "小红",
            avatar: "person/girl1.jpg",
          },
          title: "小红的骑行计划",
          tags: [
            { name: "运动", type: "sport" },
            { name: "骑行", type: "cycling" },
          ],
          people: {
            current: 5,
            total: 8,
          },
          authRequired: "任何人",
          cost: "自费",
          time: "2026.5.2 08:00 4h",
          location: "城市绿道起点",
          status: "upcoming",
          isJoined: false,
        },
        {
          id: 3,
          author: {
            nickname: "小张",
            avatar: "person/girl2.jpg",
          },
          title: "小张的剧本杀局",
          tags: [
            { name: "社交", type: "social" },
            { name: "剧本杀", type: "script" },
          ],
          people: {
            current: 6,
            total: 6,
          },
          authRequired: "任何人",
          cost: "AA制",
          time: "2026.4.30 19:00 5h",
          location: "神秘剧本杀探案馆",
          status: "ended",
          isJoined: false,
        },
        {
          id: 4,
          author: {
            nickname: "小李",
            avatar: "person/boy2.jpg",
          },
          title: "小李的读书会",
          tags: [
            { name: "学习", type: "study" },
            { name: "读书", type: "reading" },
          ],
          people: {
            current: 2,
            total: 4,
          },
          authRequired: "仅限认证",
          cost: "免费",
          time: "2026.5.3 14:00 3h",
          location: "城市图书馆",
          status: "ongoing",
          isJoined: false,
        },
        {
          id: 5,
          author: {
            nickname: "小王",
            avatar: "person/boy3.jpg",
          },
          title: "小王的约跑步",
          tags: [
            { name: "运动", type: "sport" },
            { name: "跑步", type: "running" },
          ],
          people: {
            current: 4,
            total: 6,
          },
          authRequired: "任何人",
          cost: "自费",
          time: "2026.5.4 07:00 1.5h",
          location: "滨江公园跑道",
          status: "upcoming",
          isJoined: false,
        },
        {
          id: 6,
          author: {
            nickname: "小赵",
            avatar: "person/girl3.jpg",
          },
          title: "小赵的美食聚会",
          tags: [
            { name: "社交", type: "social" },
            { name: "饭局", type: "dinner" },
          ],
          people: {
            current: 3,
            total: 5,
          },
          authRequired: "任何人",
          cost: "AA制",
          time: "2026.5.5 18:30 3h",
          location: "老成都火锅店",
          status: "ongoing",
          isJoined: false,
        },
      ];

      // 渲染觅伴活动列表
      function renderFindList(activities = findActivities) {
        const listContainer = document.querySelector(".find-list-container");
        listContainer.innerHTML = "";

        activities.forEach((activity) => {
          const card = document.createElement("div");
          card.className = "find-card";
          card.dataset.id = activity.id;

          let statusClass = "";
          let statusText = "";
          if (activity.isJoined) {
            statusClass = "find-status-joined";
            statusText = "已报名";
          } else {
            switch (activity.status) {
              case "ongoing":
                statusClass = "find-status-ongoing";
                statusText = "进行中";
                break;
              case "upcoming":
                statusClass = "find-status-upcoming";
                statusText = "即将截止";
                break;
              case "ended":
                statusClass = "find-status-ended";
                statusText = "已结束";
                break;
            }
          }

          let buttonClass = "find-join-button";
          let buttonText = "报名";
          if (activity.isJoined) {
            buttonClass = "find-cancel-button";
            buttonText = "取消";
          } else if (activity.status === "ended") {
            buttonClass = "find-join-button find-join-button-disabled";
            buttonText = "已结束";
          }

          const tagsHtml = activity.tags
            .map(
              (tag) =>
                `<span class="find-tag find-tag-${tag.type}">${tag.name}</span>`,
            )
            .join("");

          card.innerHTML = `
                    <div class="find-status-badge ${statusClass}">${statusText}</div>
                    <div class="find-card-header">
                        <div class="find-avatar-container">
                            <img class="find-avatar" src="${activity.author.avatar}" alt="${activity.author.nickname}">
                        </div>
                        <div class="find-card-info">
                            <div class="find-card-title">${activity.title}</div>
                            <div class="find-card-tags">${tagsHtml}</div>
                        </div>
                    </div>
                    <div class="find-card-details">
                        <div class="find-detail-row">
                            <div class="find-detail-item">
                                <span class="find-detail-label">人数</span>
                                <span class="find-detail-value">${activity.people.current}/${activity.people.total}</span>
                            </div>
                            <div class="find-detail-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span class="find-detail-text">${activity.authRequired}</span>
                            </div>
                        </div>
                        <div class="find-detail-row">
                            <div class="find-detail-item">
                                <span class="find-detail-label">费用</span>
                                <span class="find-detail-value">${activity.cost}</span>
                            </div>
                            <div class="find-detail-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                                <span class="find-detail-text">${activity.time}</span>
                            </div>
                        </div>
                    </div>
                    <div class="find-card-divider"></div>
                    <div class="find-card-footer">
                        <div class="find-card-location">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span>${activity.location}</span>
                        </div>
                        <button class="${buttonClass}" data-action="${activity.isJoined ? "cancel" : "join"}" data-id="${activity.id}">${buttonText}</button>
                    </div>
                `;

          listContainer.appendChild(card);
        });

        // 绑定报名/取消按钮事件
        document
          .querySelectorAll(".find-join-button, .find-cancel-button")
          .forEach((btn) => {
            if (!btn.classList.contains("find-join-button-disabled")) {
              btn.addEventListener("click", (e) => {
                e.stopPropagation();
                const id = parseInt(btn.dataset.id);
                const action = btn.dataset.action;
                openFindDetail(id, action);
              });
            }
          });
      }

      // 打开觅伴活动详情弹窗
      function openFindDetail(activityId, action) {
        const activity = findActivities.find((a) => a.id === activityId);
        if (!activity) return;

        const detailContent = document.querySelector(".find-detail-content");
        const tagsHtml = activity.tags
          .map(
            (tag) =>
              `<span class="find-tag find-tag-${tag.type}">${tag.name}</span>`,
          )
          .join("");

        let actionTitle = "";
        let confirmText = "";
        if (action === "join") {
          actionTitle = "确认报名";
          confirmText = "确认参加这个活动吗？";
        } else {
          actionTitle = "确认取消";
          confirmText = "确定要取消报名吗？";
        }

        detailContent.innerHTML = `
                    <div class="find-detail-card">
                        <div class="find-detail-header">
                            <div class="find-detail-avatar-container">
                                <img class="find-detail-avatar" src="${activity.author.avatar}" alt="${activity.author.nickname}">
                            </div>
                            <div class="find-detail-info">
                                <div class="find-detail-title">${activity.title}</div>
                                <div class="find-detail-tags">${tagsHtml}</div>
                            </div>
                            <button class="find-detail-close">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="find-detail-requirements">
                            <div class="requirement-item">
                                <span class="requirement-label">发起人</span>
                                <span class="requirement-value">${activity.author.nickname}</span>
                            </div>
                            <div class="requirement-item">
                                <span class="requirement-label">人数</span>
                                <span class="requirement-value">${activity.people.current}/${activity.people.total}</span>
                            </div>
                            <div class="requirement-item">
                                <span class="requirement-label">认证要求</span>
                                <span class="requirement-value">${activity.authRequired}</span>
                            </div>
                            <div class="requirement-item">
                                <span class="requirement-label">费用</span>
                                <span class="requirement-value">${activity.cost}</span>
                            </div>
                            <div class="requirement-item">
                                <span class="requirement-label">时间</span>
                                <span class="requirement-value">${activity.time}</span>
                            </div>
                            <div class="requirement-item">
                                <span class="requirement-label">地点</span>
                                <span class="requirement-value">${activity.location}</span>
                            </div>
                        </div>
                        <div class="find-detail-action">
                            <div class="find-detail-action-title">${actionTitle}</div>
                            <div class="find-detail-action-text">${confirmText}</div>
                            <div class="find-detail-buttons">
                                <button class="find-detail-cancel-btn">取消</button>
                                <button class="find-detail-confirm-btn" data-action="${action}" data-id="${activity.id}">确认</button>
                            </div>
                        </div>
                    </div>
                `;

        document.querySelector(".find-detail-overlay").classList.add("active");
        document.querySelector(".find-detail-page").classList.add("active");

        // 绑定关闭按钮事件
        document
          .querySelector(".find-detail-close")
          .addEventListener("click", closeFindDetail);
        document
          .querySelector(".find-detail-overlay")
          .addEventListener("click", closeFindDetail);
        document
          .querySelector(".find-detail-cancel-btn")
          .addEventListener("click", closeFindDetail);

        // 绑定确认按钮事件
        document
          .querySelector(".find-detail-confirm-btn")
          .addEventListener("click", (e) => {
            const id = parseInt(e.target.dataset.id);
            const action = e.target.dataset.action;
            if (action === "join") {
              joinActivity(id);
            } else {
              cancelActivity(id);
            }
            closeFindDetail();
          });
      }

      // 关闭觅伴活动详情弹窗
      function closeFindDetail() {
        document
          .querySelector(".find-detail-overlay")
          .classList.remove("active");
        document.querySelector(".find-detail-page").classList.remove("active");
      }

      // 报名活动
      function joinActivity(activityId) {
        const activity = findActivities.find((a) => a.id === activityId);
        if (activity) {
          activity.isJoined = true;
          renderFindList();
        }
      }

      // 取消报名
      function cancelActivity(activityId) {
        const activity = findActivities.find((a) => a.id === activityId);
        if (activity) {
          activity.isJoined = false;
          renderFindList();
        }
      }

      // 打开搜索框
      function openFindSearch() {
        document
          .querySelector(".find-search-container")
          .classList.add("active");
        document.querySelector(".find-search-input").focus();
        renderQuickSearch();
      }

      // 关闭搜索框
      function closeFindSearch() {
        document
          .querySelector(".find-search-container")
          .classList.remove("active");
        document.querySelector(".find-search-input").value = "";
        document.querySelector(".find-search-results").innerHTML = "";
      }

      // 渲染快捷搜索
      function renderQuickSearch() {
        const quickSearch = document.querySelector(".find-quick-search");
        quickSearch.style.display = "block";
        document.querySelector(".find-search-results").style.display = "none";
      }

      // 搜索活动
      function searchActivities(keyword) {
        if (!keyword.trim()) {
          renderQuickSearch();
          return;
        }

        document.querySelector(".find-quick-search").style.display = "none";
        const resultsContainer = document.querySelector(".find-search-results");
        resultsContainer.style.display = "block";

        const filtered = findActivities.filter(
          (activity) =>
            activity.title.toLowerCase().includes(keyword.toLowerCase()) ||
            activity.tags.some((tag) =>
              tag.name.toLowerCase().includes(keyword.toLowerCase()),
            ),
        );

        if (filtered.length === 0) {
          resultsContainer.innerHTML = `
                    <div class="find-no-results">
                        <div class="no-results-icon">🔍</div>
                        <div class="no-results-text">未找到相关活动</div>
                    </div>
                `;
        } else {
          resultsContainer.innerHTML = filtered
            .map(
              (activity) => `
                        <div class="find-search-result-item" data-id="${activity.id}">
                            <div class="result-item-title">${activity.title}</div>
                            <div class="result-item-tags">
                                ${activity.tags.map((tag) => `<span class="result-tag">${tag.name}</span>`).join("")}
                            </div>
                            <div class="result-item-info">${activity.location} · ${activity.time}</div>
                        </div>
                    `,
            )
            .join("");

          // 绑定搜索结果点击事件
          document
            .querySelectorAll(".find-search-result-item")
            .forEach((item) => {
              item.addEventListener("click", () => {
                const id = parseInt(item.dataset.id);
                closeFindSearch();
                const card = document.querySelector(
                  `.find-card[data-id="${id}"]`,
                );
                if (card) {
                  card.scrollIntoView({ behavior: "smooth", block: "center" });
                }
              });
            });
        }
      }

      // 快捷搜索按类型筛选
      function quickSearchByType(type) {
        closeFindSearch();
        const filtered = findActivities.filter((activity) =>
          activity.tags.some((tag) => tag.type === type),
        );
        renderFindList(filtered);
      }

      // 渲染我的搭子页面
      function renderMyPartners() {
        const detailContent = document.querySelector(".profile-detail-content");
        const joinedActivities = findActivities.filter((a) => a.isJoined);

        if (joinedActivities.length === 0) {
          detailContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 0;">
                        <div style="font-size: 60px; margin-bottom: 20px;">🤝</div>
                        <div style="font-size: 16px; color: #a3a1bf;">还没有加入任何活动哦～</div>
                    </div>
                `;
        } else {
          let html = "";
          joinedActivities.forEach((activity) => {
            const tagsHtml = activity.tags
              .map(
                (tag) =>
                  `<span class="find-tag find-tag-${tag.type}">${tag.name}</span>`,
              )
              .join("");

            html += `
                        <div class="find-card" style="margin-bottom: 15px;">
                            <div class="find-status-badge find-status-joined">已报名</div>
                            <div class="find-card-header">
                                <div class="find-avatar-container">
                                    <img class="find-avatar" src="${activity.author.avatar}" alt="${activity.author.nickname}">
                                </div>
                                <div class="find-card-info">
                                    <div class="find-card-title">${activity.title}</div>
                                    <div class="find-card-tags">${tagsHtml}</div>
                                </div>
                            </div>
                            <div class="find-card-details">
                                <div class="find-detail-row">
                                    <div class="find-detail-item">
                                        <span class="find-detail-label">人数</span>
                                        <span class="find-detail-value">${activity.people.current}/${activity.people.total}</span>
                                    </div>
                                    <div class="find-detail-item">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                        <span class="find-detail-text">${activity.authRequired}</span>
                                    </div>
                                </div>
                                <div class="find-detail-row">
                                    <div class="find-detail-item">
                                        <span class="find-detail-label">费用</span>
                                        <span class="find-detail-value">${activity.cost}</span>
                                    </div>
                                    <div class="find-detail-item">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <polyline points="12 6 12 12 16 14"></polyline>
                                        </svg>
                                        <span class="find-detail-text">${activity.time}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="find-card-divider"></div>
                            <div class="find-card-footer">
                                <div class="find-card-location">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    <span>${activity.location}</span>
                                </div>
                            </div>
                        </div>
                    `;
          });
          detailContent.innerHTML = html;
        }
      }

      // 修改openProfileDetail函数，支持我的搭子页面
      const originalOpenProfileDetail = openProfileDetail;
      openProfileDetail = function (menuId) {
        const title = menuNames[menuId] || "详情";
        document.querySelector(".profile-detail-title").textContent = title;

        const detailContent = document.querySelector(".profile-detail-content");

        if (menuId === "favorites") {
          renderFavorites();
        } else if (menuId === "partners") {
          renderMyPartners();
        } else {
          detailContent.innerHTML = `
                    <div style="text-align: center; padding: 40px 0;">
                        <div style="font-size: 18px; color: #333; margin-bottom: 10px;">${title}</div>
                        <div style="font-size: 14px; color: #a3a1bf;">功能开发中...</div>
                    </div>
                `;
        }

        document
          .querySelector(".page-profile-detail-overlay")
          .classList.add("active");
        document
          .querySelector(".page-profile-detail-page")
          .classList.add("active");
      };

      // 觅伴页面事件是否已绑定
      let findEventsBound = false;

      // 初始化觅伴页面
      function initFindPage() {
        renderFindList();

        if (findEventsBound) return;

        // 绑定标签点击事件
        document.querySelectorAll(".find-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            document
              .querySelectorAll(".find-tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");
          });
        });

        // 绑定搜索按钮点击事件
        document
          .querySelector(".find-search-button")
          .addEventListener("click", openFindSearch);

        // 绑定搜索框关闭按钮事件
        document
          .querySelector(".find-search-close")
          .addEventListener("click", closeFindSearch);

        // 绑定搜索框输入事件
        document
          .querySelector(".find-search-input")
          .addEventListener("input", (e) => {
            searchActivities(e.target.value);
          });

        // 绑定快捷搜索标签点击事件
        document.querySelectorAll(".quick-search-tag").forEach((tag) => {
          tag.addEventListener("click", () => {
            const type = tag.dataset.type;
            quickSearchByType(type);
          });
        });

        findEventsBound = true;
      }
    </script>
  </body>
</html>
